## Занятие 1. Задачи мониторинга и алертинга ##

#### Цели занятия
- разобраться в том, что такое мониторинг;  
- объяснить как строить мониторинг правильно;  
- рассмотреть хорошие и плохие паттерны мониторинга;  
- Black/white boxing;  
- инструменты мониторинга;  
- инструменты алертинга;  
- time-series базы данных.


## Основные тезисы 
#### Что мониторить?  
- Инфраструктура,  
- Вспомогательные сервисы,  
- Качество работы и состояние приложения,  
- Бизнесметрики.  

#### Хорошие практики  
- Мониторинг из многих компонентов как правило лучше, чем один монолит.  
- Мониторинг -- это не только про оповещения.  
- Построение мониторинга необходимо начинать с пользовательских метрик.   
- Если есть возможность, то лучше начинать с мониторинга как сервис ([Datadog](https://www.datadoghq.com/), [New Relic](https://newrelic.com/), [okmeter.io)](https://okmeter.io/), чем разворачивать свою инфраструктуру.  
- Постоянное улучшение всех компонентов.  

#### Плохие практики  
- Одержимость выбором инструментов;  
- &laquo;Специальный&raquo; отдел мониторинга;  
- Мониторинг для галочки;  
- Использование мониторинга в качестве &laquo;костыля&raquo;;  
- Ручное конфигурирование.  

#### Способы организации мониторинга  
- *White Box* -- это мониторинг, базирующийся на метриках, которые даёт само приложение/сервис (через логи, интерфейсы, `API`, `SNMP`);   
- *Black Box* -- это мониторинг, оценивающий внешнее состояние сервиса/системы (`ping`, `HTTP request`, открытый порт, наличие процессов).  

#### Основные метрики системы  
- LoadAvg, CPU, Net (bps/pps), DISK Load;  
- потребление Mem/DISK;  
- &laquo;чистота&raquo; системных логов: dmesg, messages;  
- Актуальность состояния резервных копий.

#### Метрики сервиса  
- &laquo;диагностический запрос&raquo;, который задействует все или большинство компонентов системы;  
- время отклика/обработки запроса;  
- количество обращений в единицу времени;  
- количество одновременных обращений.  

#### Характеристики временного ряда
- Ориентированы на время -- каждая запись имеет отметку времени;  
- Только добавление -- данные только добавляются, но не обновляются;  
- Работа со свежими данными.  

#### Хранение исторических данных в NoSQL  
- Обычные (Elasticsearch);  
- NotNoSQL ([Clickhouse](https://clickhouse.tech/));  
- Специализированные (Victoria Metrics, Thanos, Cortex).  

#### Инструменты мониторинга  
- `Zabbix` -- свой агент, свой веб, SQL database.  
- `nagios` / `Icinga` -- свой агент, свой веб, SQL database.  
- `Graphite` -- carbon (агент), whisper (tsdb), graphite-web.  
- `Cacti`, `ganglia`, `collectd`, `mrtg`, `munin` -- база `rrdtool`.  
- `Netdata` -- агент и веб.  
- `Prometheus` -- node_exporter (агент), prometheus (база, веб), alertmanager.  
- `InfluxData` -- telegraph (агент), influxdb, chronograph (web), kapacitor (alerts).  
- `StatsD` -- набор инструментов для сбораметрик.  
- `Graphana` -- интерфейс для дашбордов и алертинга.  
